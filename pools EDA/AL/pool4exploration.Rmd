---
title: "Pool 4 Lower Exploration"
author: "Amber Lee"
date: "6/3/2021"
output: pdf_document
---

```{r}
library(tidyverse)
library(ggplot2)
library(lubridate)
```

pictures, geographical information about the pool
some data information

* for example, casey only has main channel and side channel data. (what are the strata that we have?)

* statistical summary of 4 variables: `TP`, `CHLcal`, `SS`, `TURB`

* number of observations per strata

* future directions / ideas

* an interesting paper or article from USGS website relating to pool 4 lower

* missing data

* extreme outliers

* `TP` and `TN` may have some missing values

(next friday: learn to pose own questions within an ecosystem framework, explain the project in our own words)

```{r}
veg19 <- read.csv(file = "../2019 pool data/ltrm_vegsrs_data_lat_long.csv")
water19 <- read.csv(file = "../2019 pool data/ltrm_water_data_lat_long.csv")
```

## Vegetation data

```{r}
veg19 %>% 
  filter(POOL == "04",
         str_detect(MSTRATUM, "-L")) %>%
  select(DATE, DETRITUS, SBSTRATE, VEG_S, VEG_RF, 
         VEG_E, VEG_A, VEG_NRF, VEG_U,
         COV_NRF, COV_RF, COV_E,
         RAKE1, RAKE2, RAKE3, RAKE4, RAKE5, RAKE6) %>% head()

veg_4L <- veg19 %>% 
  filter(POOL == "04",
         str_detect(MSTRATUM, "-L")) %>%
  mutate(DATE = mdy(DATE))
```

Rake distribution

```{r}
veg_4L %>% 
  mutate(year = year(DATE)) %>%
  select(year, RAKE1, RAKE2, RAKE3, RAKE4, RAKE5, RAKE6) %>%
  pivot_longer(!year, names_to = "subsample_rake",
               values_to = "level") %>%
  group_by(year) %>%
  summarize(mean_level = mean(level),
            sd_level = sd(level)) %>%
  ggplot(aes(x = year, y = mean_level, 
             fill = sd_level)) +
  geom_point()
  
  # 
  # ggplot(aes(x = RAKE1)) +
  # geom_histogram()
```

Water depth

```{r}
veg_4L %>% 
  mutate(year = year(DATE)) %>%
  select(year, starts_with("DEPTH")) %>%
  pivot_longer(!year, names_to = "subsample",
               values_to = "depth") %>%
  ggplot(aes(x = year, y = depth, group = year)) +
  geom_boxplot()
  
  # 
  # ggplot(aes(x = RAKE1)) +
  # geom_histogram()
```

plant density

```{r}
veg_4L %>% 
  mutate(year = year(DATE)) %>%
  select(year, starts_with("DENSITY")) %>%
  pivot_longer(!year, names_to = "subsample",
               values_to = "density") %>%
  ggplot(aes(x = year, y = density, group = year)) +
  stat_summary(
    mapping = aes(x = year, y = density),
    fun.min = function(z) { quantile(z,0.25) },
    fun.max = function(z) { quantile(z,0.75) },
    fun = mean)
```

## Water data

```{r}

water19 %>%
  filter(FLDNUM == "1") %>%
  mutate(`Pool 4 Regions` = case_when(LONGITUDE <= -92.33 ~ "Lower",
                                      LONGITUDE >= -92.035 ~ "Upper",
                                      TRUE ~ "A lake")) %>%
  ggplot(aes(x = LATITUDE, y = LONGITUDE)) +
  geom_point(aes(color = `Pool 4 Regions`)) +
  geom_abline(intercept = -92.035, slope = 0) +
  geom_abline(intercept = -92.33, slope = 0) +
  ggtitle("Upper and Lower Pool 4")

```


```{r}

# filter for pool 4 lower
water_4L <- water19 %>% 
  filter(FLDNUM == "1") %>%
  mutate(DATE = mdy(DATE),
         year = year(DATE),
         is_lower = case_when(LONGITUDE <= -92.33 ~ TRUE,
                              TRUE ~ FALSE)) %>%
  filter(is_lower)

water_var <- c('TN','TP','TEMP','DO','TURB',
               'COND','VEL','SS','WDP','CHLcal','SECCHI')

plotter_box_by_year <- function(var_str, data, facet_bool){
  
  # facet_bool gives if you should facet by STRATUM type
  
  title <- paste("boxplot_by_year", "4L", var_str, sep = "_")
  
  if (facet_bool){title <- paste(title, "_facet")}
  
  title <- paste(title, "png", sep = ".")
  
  if (facet_bool){
    data %>%
      filter(!is.na(!!sym(var_str))) %>%
      ggplot(aes(x = year, y = !!sym(var_str), group = year)) +
      geom_boxplot() + 
      facet_wrap(~ STRATUM)
  } else {
    data %>%
      filter(!is.na(!!sym(var_str))) %>%
      ggplot(aes(x = year, y = !!sym(var_str), group = year)) +
      geom_boxplot()
  }
  
  ggsave(title)

}

sapply(water_var, plotter_box_by_year, water_4L, F)
sapply(water_var, plotter_box_by_year, water_4L, T)



# SS, turbidity, and secchi all three measure water quality

# velocity graph is new

# dissolved oxygen is variable by the time of day

# temperature is important per season

# habitat class for these water quality data is all NA
# unique(water_4L$HABCLASS)

unique(water_4L$STRATUM)

hist(water_4L$STRATUM)

```

Note: stratum types
1 = Main channel
2 = Side channel
3 = Backwater area contiguous to the main channel
4 = Lake Pepin or Swan Lake


* total nitrogen is variable by year, but within year, not too variable

* velocity has increased, water volume is greater. increase in velocity reflects collection in data? collect



```{r}
water_4L %>%
  mutate(season = quarter(DATE)) %>%
  ggplot(aes(x = year, y = TEMP, group = year)) +
  geom_boxplot() +
  facet_wrap(~ season)

water_4L %>%
  mutate(season = quarter(DATE)) %>%
  ggplot(aes(x = year, y = DO, group = year)) +
  geom_boxplot() +
  facet_wrap(~ season)
```


[website](umesc.usgs.gov/ltrm-home.html)


